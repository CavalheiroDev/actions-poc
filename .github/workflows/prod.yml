name: Release to production (Manual)

on:
  workflow_dispatch:


jobs:
  verify:
    defaults:
      run:
        shell: bash

    name: Checando tags
    runs-on: ubuntu-latest
    steps:
      - name: Erro - Tag invalida
        if: ${{ !startsWith(github.ref, 'refs/tags/') }}
        run: |
          echo "Por favor selecione uma tag para fazer o deploy!"
          exit 1
      
      - name: Verificação concluida com sucesso!
        if: ${{ startsWith(github.ref, 'refs/tags/') }}
        run: |
          echo "Tag selecionada com sucesso! Iniciando processo de deploy."

build:
  name: Buildando imagem
  runs-on: self-hosted

  steps:
    - name: Checkout for Tag
      uses: actions/checkout@v3

    - name: Get the release version
      # i.e.: v1.0.0 -> 1.0.0
      id: strip-branch-name
      run: |
        release_version=$(echo "${{ github.ref }}")
        echo "Building release version $release_version"
        echo "RELEASE_VERSION=$release_version" >> $GITHUB_ENV
        shell: bash